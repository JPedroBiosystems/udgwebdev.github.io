<!DOCTYPE html><html lang="en" manifest="/manifest.appcache" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"><head><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/><meta charset="utf-8"/><title>Evitando callback hell no node.js | Underground WebDev</title><meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#BA2D27"/><meta name="apple-mobile-web-app-title" content="UDGWebDev"/><meta name="msapplication-TileImage" content="https://udgwebdev.com/images/undefined-128.png"/><meta name="msapplication-TileColor" content="#BA2D27"/><meta name="msapplication-tap-highlight" content="no"/><meta name="mobile-web-app-capable" content="yes"/><meta name="application-name" content="UDGWebDev"/><meta name="theme-color" content="#BA2D27"/><meta name="title" content="Evitando callback hell no node.js"/><meta name="author" content="Caio Ribeiro Pereira"/><meta name="description" content="O objetivo desse post é apresentar boas práticas para lidar com encadeamento de múltiplas funções assíncronas que criam o mais irritante callback hell no node.js."/><meta property="og:title" content="Evitando callback hell no node.js"/><meta property="og:description" content="O objetivo desse post é apresentar boas práticas para lidar com encadeamento de múltiplas funções assíncronas que criam o mais irritante callback hell no node.js."/><meta property="og:url" content="https://udgwebdev.com/evitando-callback-hell-no-node-js"/><meta property="og:site_name" content="Underground WebDev"/><meta property="og:image" content="https://udgwebdev.com/images/udgwebdev-logo.png"/><meta property="og:type" content="website"/><meta property="article:author" content="https://plus.google.com/+CaioRibeiroPereira"/><meta property="article:section" content="main"/><meta name="twitter:creator" content="@crp_underground"/><meta name="twitter:card" content="summary"/><meta name="twitter:url" content="https://udgwebdev.com/evitando-callback-hell-no-node-js"/><meta name="twitter:title" content="Evitando callback hell no node.js"/><meta name="twitter:description" content="O objetivo desse post é apresentar boas práticas para lidar com encadeamento de múltiplas funções assíncronas que criam o mais irritante callback hell no node.js."/><meta name="twitter:image" content="https://udgwebdev.com/images/udgwebdev-logo.png"/><link rel="manifest" href="/manifest.json"/><link rel="stylesheet" href="/assets/css/main.css" type="text/css"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="canonical" href="https://udgwebdev.com/evitando-callback-hell-no-node-js"/></head><body><nav role="navigation" class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><img src="/images/udgwebdev-logo.png" alt="Underground WebDev" width="48" class="navbar-logo"/></a></div><div class="navbar-right navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="/nodejs"><i class="fa fa-code"></i>&nbsp;Node.js</a></li><li><a href="/meteor"><i class="fa fa-code"></i>&nbsp;Meteor</a></li><li><a href="/dicas-de-terminal"><i class="fa fa-terminal"></i>&nbsp;Terminal</a></li></ul></div></div></nav><nav role="navigation" class="c-circle-menu js-menu"><button class="c-circle-menu__toggle js-menu-toggle"><span>Toggle</span></button><ul class="c-circle-menu__items"><li class="c-circle-menu__item"><a href="http://feeds.feedburner.com/UndergroundWebDev" target="_blank" rel="nofollow" title="Feed" class="c-circle-menu__link"><i class="icon fa fa-rss"></i></a></li><li class="c-circle-menu__item"><a href="https://github.com/caio-ribeiro-pereira" target="_blank" rel="nofollow" title="Github" class="c-circle-menu__link"><i class="icon fa fa-github"></i></a></li><li class="c-circle-menu__item"><a href="https://www.facebook.com/udgwebdev" target="_blank" rel="nofollow" title="Fanpage" class="c-circle-menu__link"><i class="icon fa fa-facebook-square"></i></a></li><li class="c-circle-menu__item"><a href="http://twitter.com/crp_underground" target="_blank" rel="nofollow" title="Twitter" class="c-circle-menu__link"><i class="icon fa fa-twitter-square"></i></a></li><li class="c-circle-menu__item"><a href="https://www.linkedin.com/in/caioribeiropereira" target="_blank" rel="nofollow" title="LinkedIn" class="c-circle-menu__link"><i class="icon fa fa-linkedin-square"></i></a></li></ul><div class="c-circle-menu__mask js-menu-mask"></div></nav><main role="main" class="container vertical-centralization"><div class="row"><article id="evitando-callback-hell-no-node-js" class="col-xs-12 col-sm-9 post"><h1>Evitando callback hell no node.js</h1><p class="text-muted">Publicação: <time datetime="12/06/2013" pubdate><b>12/06/2013</b></time> | Tags: <a href="/menu/#node.js" rel="me" title="Menu: Node.js">Node.js</a></p><p><img src="/images/callback-hell.jpg" alt="Evitando Callback Hell" title="Evitando Callback Hell"></p>
<p>De fato vimos o quanto é vantajoso e performático trabalhar de forma assíncrona, porém em certos momentos, inevitavelmente implementaremos diversas funções assíncronas, que serão encadeadas uma na outra através das suas funções callback. No código a seguir apresentarei um exemplo desse caso, crie um arquivo chamado <code>callback_hell.js</code>, implemente e execute o código abaixo:</p>
<pre><code class="language-javascript"> var fs = require(&#39;fs&#39;);
 fs.readdir(__dirname, function(erro, contents) {
   if (erro) { throw erro; }
   contents.forEach(function(file) {
     var path = &#39;./&#39; + file;
     fs.stat(path, function(erro, stat) {
       if (erro) { throw erro; }
       if (stat.isFile()) {
         console.log(&#39;%s %d bytes&#39;,file,stat.size);
       }
     });
   });
 });
</code></pre>
<p>Reparem na quantidade de callbacks encadeados existem em nosso código, detalhe, ele apenas faz uma simples leitura dos arquivos de seu diretório e imprime na tela seu nome e tamanho em bytes. Um pequena tarefa como essa deveria ter menos encadeamentos, concorda? Agora imagine como seria a organização disso para realizar tarefas mas complexas? Praticamente seria um chaos o seu código e totalmente difícil de fazer manutenções.</p>
<p>Por ser assíncrono você perde o controle do que esta executando em troca de ganhos com performance, porém, um detalhe importante sobre assincronismo é que na maioria dos casos os callbacks bem elaborados possuem como parâmetro uma variável de erro. Verique nas documentações sobre sua existência e sempre faça o tratamento deles na execução do seu callback: <code>if (erro) { throw erro; }</code>, isso vai impedir a continuação da execução aleatória quando for identificado um erro.</p>
<p>Uma boa prática de código Javascript é criar funções que expressem seu objetivo e de forma isoladas, salvando em variável e passando-as como callback, ao invés de criar funções anônimas, por exemplo, crie um arquivo chamado <code>callback_heaven.js</code> com o código abaixo:</p>
<pre><code class="language-javascript"> var fs = require(&#39;fs&#39;);
 var lerDiretorio = function() {
   fs.readdir(__dirname, function(erro, dir) {
     tratar(erro);
     dir.forEach(function(file) {
       ler(file);
     });
   });
 };
 var ler = function(file) {
   var path = &#39;./&#39; + file;
   fs.stat(path, function(erro, stat) {
     tratar(erro);
     if (stat.isFile()) {
       console.log(&#39;%s %d bytes&#39;,file,stat.size);
     }
   });
 };
 var tratar = function(erro) {
   if (erro) { throw erro; }
 };
 lerDiretorio();
</code></pre>
<p>Veja o quanto melhorou a legibilidade do seu código. Dessa forma foi possível reaproveitar a função <code>tratar(erro)</code> em dois locais do código, deixamos mais semântico e legível o nome das funções e diminuímos o encadeamento de callback das funções assíncronas. A boa prática é ter o bom senso de manter no máximo até dois encadeamentos de callbacks, ao passar disso significa que esta na hora de criar uma nova função fora externa para ser chamada no último callback, ao invés de continuar criando um <strong>callback hell</strong> em seu código.</p>
<p>Fonte: <a href="https://www.casadocodigo.com.br/products/livro-nodejs" title="Aplicações web real-time com Node.js">Aplicações web real-time com Node.js</a></p><div id="disqus_thread"></div><script async="async" defer="defer">(function() {
  var disqus_shortname = 'udgwebdev';
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Por favor, habilite o JavaScript no seu browser para visualizar os comentários deste post.</noscript><script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Evitando callback hell no node.js",
  "image": "https://udgwebdev.com/images/udgwebdev-logo.png",
  "publisher": "Underground WebDev",
  "url": "https://udgwebdev.com/evitando-callback-hell-no-node-js",
  "datePublished": "2013-06-12",
  "dateCreated": "2013-06-12",
  "description": "O objetivo desse post é apresentar boas práticas para lidar com encadeamento de múltiplas funções assíncronas que criam o mais irritante callback hell no node.js.",
  "author": {
    "@type": "Person",
    "name": "Caio Ribeiro Pereira"
  }
}</script></article></div></main><footer class="footer text-center"><p><small><i class="fa fa-trophy"></i>&nbsp;Powered by <a href="https://pages.github.com" rel="nofollow" target="_blank" title="Github Pages">Github Pages</a>, <a href="http://gruntjs.com" rel="nofollow" target="_blank" title="Grunt">Grunt</a> and <a href="http://harpjs.com" rel="nofollow" target="_blank" title="Harp.js">Harp.js</a>.</small><br/><small>Autor: <a href="https://crpwebdev.github.io" rel="me" target="_blank" title="Caio Ribeiro Pereira">Caio Ribeiro Pereira</a>.</small></p></footer><script src="/assets/js/circlemenu.min.js"></script><script src="/assets/js/main.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-25728091-2', 'auto');
ga('send', 'pageview');</script></body></html>