---
layout: post
title: Primeiros passos com Meteor
tags: Meteor
keywords: Meteor, MeteorJS, Aplicação com Meteor, Desenvolvendo com Meteor, Programando com Meteor
description: Neste post vamos aprender na prática os primeiros passos sobre como construir uma aplicação utilizando o framework Meteor.
published: true
image_url: meteor-logo.jpg
---
<figure class="post-image">
  <a href="http://meteor.com" target="_blank">
    <img src="{{ site.url }}/images/meteor-logo.jpg" width="250" height="110" alt="Meteor" title="Meteor">
  </a>
</figure>
<div class="post-content">
  <p>Depois de um <a href="{{ site.url }}/introducao-sobre-meteor" target="_blank" rel="me" title="Introdução sobre Meteor">post de introdução sobre Meteor</a>, iremos neste post aprender na prática, os primeiros passos sobre como construir uma aplicação utilizando o framework Meteor.</p>
  <p>Construiremos um simples micro-blog, semelhante ao twitter, em que as <strong>atualizações da timeline pública serão em real-time</strong>. Outro detalhe faremos essa aplicação utilizando os conceitos básicos do Meteor, ou seja, não entraremos em detalhes com boas práticas e organizações de código (afinal esse será assunto para um próximo post), o projeto será criado com apenas <strong>3 arquivos (1 HTML, 1 CSS e 1 Javascript)</strong>.</p>
  <p>Bom vamos começar? Instale o Meteor é super simples, para ele funcionar é necessário ter o Node e MongoDB instalado primeiro, caso não tenha o Node.js, veja nesse post: <a href="{{ site.url }}/node-js-para-leigos-instalacao-e-configuracao" target="_blank" rel="me" title="Node.js para leigos - Instalação e configuração">Node.js para leigos instalação e configuração</a> como instalá-lo e sobre o MongoDB recomendo que acesse seu site oficial e leia o <a href="http://docs.mongodb.org/manual/installation/" title="MongoDB Installation Guides">manual de instalação MongoDB</a>.
  <p><strong>Atenção: O Meteor ainda não possui versão compatível com Windows, somente Mac, Linux e Unix. Este problema será resolvido apartir da versão 1.0, <a href="http://www.meteor.com/blog/2013/10/01/geoff-schmidt-at-devshop-8-getting-meteor-to-10" target="_blank">prevista para o começo de 2014</a>.</strong></p>
  <p>Com o Node.js e MongoDB instalado execute os comandos abaixo para instalar o Meteor:</p>
{% highlight bash %}
curl https://install.meteor.com | /bin/sh
{% endhighlight %}
	<p>Agora que temos o ambiente configurado, vamos criar o nosso micro-blog, chamarei nossa aplicação de <strong>"microtwitter"</strong>, mas você pode chamá-la do que quiser, apenas siga os comandos abaixo para criar o projeto:</p>
{% highlight bash %}
meteor create microtwitter
cd microtwitter
{% endhighlight %}
	<p>Repare que por default o Meteor criou os 3 arquivos iniciais (1 HTML, 1 CSS e 1 Javascript) e será em cima deles que codificaremos nosso app.</p>
	<p>Vamos implementar inicialmente o layout da aplicação. Toda interação real-time no front-end é realizada através de um template engine. Criaremos os templates para cada área interativa do nosso sistema utilizando o template padrão do Meteor, o <a href="http://handlebarsjs.com" target="_blank">Handlebars</a>. No nosso app teremos um formulário para envio de mensagem e uma área de timeline de mensagens públicas. Edite o arquivo <strong>microtwitter.html</strong> inserindo o código abaixo:</p>
{% highlight html %}
{% raw %}
<head>
  <title>MicroTwitter</title>
</head>
<body>
 {{> formulario }}
 {{> mensagens }}
</body>
<template name="formulario"></template>
<template name="mensagens"></template>
{% endraw %}
{% endhighlight %}
	<p>Essa será a estrutura do nosso layout, o que faremos agora é implementar os 2 templates internos. Então continuando no mesmo arquivo, criaremos o template de formulário:</p>
{% highlight html %}
<template name="formulario">
  <div class="formulario">
    <h1>MicroTwitter</h1>
    <input type="text" id="nome" name="nome" placeholder="Nome">
    <textarea id="conteudo" name="conteudo" placeholder="Mensagem" maxlength="140"></textarea>
    <button id="enviar">Enviar</button>
  </div>
</template>
{% endhighlight %}
  <p>Em seguida, criaremos o template da timeline de mensagens:</p>
{% highlight html %}
{% raw %}
<template name="mensagens">
  <div class="timeline">
    <h1>Timeline</h1>
    {{#each timeline}}
      <hr>
      <p class="mensagem">
        {{conteudo}}
        <br>
        <small>{{nome}} {{data}}</small>
      </p>
    {{else}}
      <p class="info">
        <small>Nenhuma mensagem publicada.</small>
      </p>
    {{/each}}
  </div>
</template>
{% endraw %}
{% endhighlight %}

  {% include content-ads.ext %}
  <p>Caso queira adicionar um estilo no seu app, edite o <strong>microtwitter.css</strong> aplicando o CSS que desejar ou <a href="https://github.com/caio-ribeiro-pereira/microtwitter/blob/master/microtwitter.css" target="_blank">utilize como referência esse aqui do meu Github</a>, pelo qual utilizei para criar essa aplicação.</p>
  <p>Nesta última etapa implementaremos as regras de negócio. A regra será simples, criaremos um formulário que em seu submit enviará os <strong>campos nome e mensagem</strong> para o banco de dados, que automaticamente atualizará a <strong>timeline mensagens</strong>. Essa atualização acontecerá em real-time sem criar código adicional para realizar a atualização, isso ocorre graças <a href="http://docs.meteor.com/#reactivity" target="_blank">ao conceito de reactive programming</a> do Meteor, pelo qual alguns componentes já vem nativo esse pattern, no nosso código o namespace <code>Template</code> é 100% reativo. Vamos criar toda lógica dentro do <strong>microtwitter.js</strong>, pelo qual teremos nele, código compartilhado entre <strong>client-side e server-side</strong>. Veja como será o código do nosso app abaixo:</p>

{% highlight javascript %}
Mensagem = new Meteor.Collection('mensagem');
if (Meteor.isClient) {
  Template.formulario.events({
    'click #enviar': function(event, template) {
      var nome = template.find('#nome').value;
      var conteudo = template.find('#conteudo').value;
      Mensagem.insert({ nome: nome,
                        conteudo: conteudo,
                        data: new Date().toLocaleString() });
      event.preventDefault();
    }
  });

  Template.mensagens.timeline = function() {
    return Mensagem.find();
  };
}

if (Meteor.isServer) {
  Meteor.startup(function () {
    Mensagem.remove({});
    console.log("Rodando MicroTwitter");
  });
}
{% endhighlight %}

  <p>Tecnicamente, o Meteor possui duas variáveis que informa se um trecho de código será executado no cliente (<code>Meteor.isClient</code>) ou no servidor (<code>Meteor.isServer</code>). No desenvolvimento de projetos grandes, essa não é a melhor prática, pois criaremos um código repleto de condicionais, mas fique tranquilo! Nos próximos posts exploraremos as boas práticas de organização e desenvolvimento com Meteor.</p>
  <p>Uma das vantagens do Meteor é o compartilhamento de código entre cliente-servidor, ele faz essa magia através das variáveis globais do JavaScript, por exemplo, no nosso código a collection <code>Mensagem</code> esta compartilhada, e isso possibilitou executar queries tanto no cliente como no servidor utilizando apenas uma única instância.</p>
  <p>Cada template possui funções <strong>helpers e events</strong>.</p>
  <p>A convenção de helpers funciona da seguinte forma: <code>Template.nome_do_template.nome_do_helper</code> e no html do template você acessa esse helper chamando-a via tags do Handlebars, por exemplo, estamos chamando o helper <code>Template.mensagens.timeline</code> dentro da tag &lt;template name=&quot;mensagens&quot;&gt; através do comando: <code>&#123;&#123;#each timeline&#125;&#125;</code>.</p>
  <p>Já os <code>events</code> permite criar eventos para os elementos interno de um template. Ele segue a seguinte convenção: <code>Template.nome_do_template.events()</code>. Em seu paramêtro enviamos um objeto chave-valor, em que cada chave é referente a um <code>evento + elemento</code> do template a ser tratado e o valor é uma função callback do evento. No nosso app, criamos apenas um evento:</p>

{% highlight javascript %}
Template.formulario.events({
  'click #enviar': function(event, template) {
    //... callback do evento
  }
});
{% endhighlight %}

  <p>Outro detalhe é que por default no client-side já temos habilitado o jQuery e Underscore, e isso facilita capturar e manipular objetos DOM do HTML, como por exemplo, capturamos os os valores dos <strong>campos nome e mensagem</strong> do formulário.</p>
  <p>Agora que terminamos nosso app, que tal testá-lo?<br>Para levantar o servidor execute o comando: <code>meteor</code> e em seguida acesse: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> para brincar a aplicação. :)</p>
</div>
