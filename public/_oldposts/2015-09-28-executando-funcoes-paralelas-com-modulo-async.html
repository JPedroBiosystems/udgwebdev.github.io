---
layout: post
title: Executando funções paralelas com módulo async
tags: Node.js
keywords: Node.js, async, parallel
published: true
description: Neste post vou explicar como organizar e rodar múltiplas funções assíncronas de forma que elas sejam otimizadas para serem executadas em paralelo.
image_url: nodejs-logo.jpg
---
<figure class="post-image">
  <img src="{{ site.url }}/images/nodejs-logo.jpg" width="250" height="86" alt="Funções paralelas usando async" title="Funções paralelas usando async">
  <figcaption>Funções paralelas usando async</figcaption>
</figure>
<div class="post-content">
  <p>
    Para quem não conhece, o módulo <a href="https://github.com/caolan/async" target="_blank" rel="nofollow" title="Github do async">async</a> é muito útil quando se precisa de um framework para manipular fluxo de execuções assíncronas, com ele é possível organizar de forma elegante todo código de funções assíncronas, assim como também organizar a execução de cada uma delas.
  </p>
  <p>
    Neste post vou explicar como organizar e rodar múltiplas funções assíncronas de forma que elas sejam otimizadas para serem executadas em paralelo.
  </p>
  <p>
    A vantagem de executar em paralelo as funções assíncronas é em relação ao ganho de performance em maximizar o uso de CPU para trabalhar com múltiplas tarefas ao mesmo tempo, e o mais interessante é que ao usar o módulo <a href="https://github.com/caolan/async" target="_blank" rel="nofollow" title="Github do async">async</a> para paralelizar suas funções, você poderá trabalhar em cima do resultado final desse tipo de execução através do callback da função <code>async.parallel()</code>.
  </p>
  <p>
    Para começar, instale o <a href="https://github.com/caolan/async" target="_blank" rel="nofollow" title="Github do async">async</a> em seu projeto:<br>

{% highlight bash %}
npm install --save async
{% endhighlight %}

  </p>
  <p>
    Para mostrar na prática o quão simples é implementar esse processamento paralelo, vamos criar uma simples <strong>função que espera 2 segundos para mostrar no terminal uma string que for passada em parâmetro</strong>, veja o código abaixo:<br>

{% highlight javascript %}
function test(msg, callback) {
  setTimeout(function() {
    console.log(msg);
    callback();
  }, 2000);
}
{% endhighlight %}

  </p>
  {% include content-ads.ext %}
  <p>
    Com base nessa função faremos dois código, em que o primeiro executará duas vezes essa função em sequencial e o segundo executará duas vezes em paralelo, veja como deve ficar o código completo:<br>

{% highlight javascript %}
const async = require("async");

function test(msg, callback) {
  setTimeout(function() {
    console.log(msg);
    callback();
  }, 2000);
}

console.time("Execução normal");
test("Mundo async!",function() {
  test("Mundo async!", function() {
    console.timeEnd("Execução normal");
  });
});

console.time("Execução paralela");
async.parallel([
  function(callback) {
    test("Mundo paralelo!", function() {
      callback();
    });
  },
  function(callback) {
    test("Mundo paralelo!", function() {
      callback();
    });
  }
], function() {
  console.timeEnd("Execução paralela");
});
{% endhighlight %}
  </p>
  <p>
    Repare que ambos os códigos estão calculando o tempo de execução através das funções <code>console.time()</code> e <code>console.timeEnd()</code>, na minha máquina rodando 3x o mesmo código, os resultados foram esses:<br>
    <figure class="post-image">
      <a href="{{ site.url }}/images/async-vs-parallel.png" title="Resultado do benchmark: async vs parallel">
        <img src="{{ site.url }}/images/async-vs-parallel-small.png" alt="Resultado do benchmark: async vs parallel">
        <figcaption>Benchmark: async vs parallel (clique na imagem)</figcaption>
      </a>
    </figure>
  </p>
  <p>
    <strong>Conclusão:</strong> Sempre que puder, otimize processamento de suas funções no Node.js utilizando o módulo <a href="https://github.com/caolan/async" target="_blank" rel="nofollow" title="Github do async">async</a> via função <code>async.paralell</code> para obter um ganho em performance.<br>
    <strong>Observação:</strong> Um detalhe bacana que o <a href="https://disqus.com/by/ItacirPompeu/" target="_blank" rel="nofollow">Itacir Pompeu</a> comentou abaixo é que esse módulo <a href="https://github.com/caolan/async" target="_blank" rel="nofollow" title="Github do async">async</a> também pode ser usado no client-side de uma aplicação.
  </p>
</div>
