---
layout: post
title: Brincando com LevelDB
tags:
- Node.js
- NoSQL
keywords: LevelDB, LevelUP, LevelDown, NoSQL LevelDB
published: true
description: O LevelDB é um banco de dados que possui uma forte ligação com Node.js. Ele basicamente é um banco semelhante ao SQLite, um embedded database, porém em NoSQL do tipo key-value.
image_url: leveldb.jpg
---
<figure class="post-image">
  <img src="{{ site.url }}/images/leveldb.jpg" width="240" height="240" alt="Brincando com LevelDB" title="Brincando com LevelDB">
  <figcaption>Brincando com LevelDB</figcaption>
</figure>
<div class="post-content">
  <p>O LevelDB é um banco de dados que possui uma forte ligação com Node.js. Ele basicamente é um banco semelhante ao <a href="http://www.sqlite.org/" target="_blank">SQLite</a>, um embedded database, porém em NoSQL do tipo key-value.</p>
  <p>Este é um projeto open source criado pelo Google, afinal de início, o objetivo inicial era de criar um db nativo para o Chrome, em que levasse algumas características de <a href="http://pt.wikipedia.org/wiki/BigTable" target="_blank">BigTable</a>, e assim surgiu o <a href="http://www.html5rocks.com/pt/tutorials/indexeddb/todo" target="_blank">IndexedDB</a>.</p>
  <p>O LevelDB ficou tão popular que algumas empresas fizeram forks dele. E assim surgiu o <a href="http://basho.com/riak/" target="_blank">Riak</a> um DB escrito em Erlang pela empresa Basho, surgiu o <a href="http://wordpress.org/plugins/hyperdb" target="_blank">HyperDB</a> da empresa Hyperdex e o <a href="http://rocksdb.org/" target="_blank">RocksDB</a> que é mantido pela equipe do Facebook.</p>
  <p>Para a comunidade Node.js, existe o <a href="https://github.com/rvagg/node-leveldown" target="_blank">LevelDown</a> (versão baixo nível em linguagem C compilado para rodar no Node.js) e o <a href="https://github.com/rvagg/node-levelup" target="_blank">LevelUP</a> (API Node que executa as funcionalidades do LevelDown). Esses dois módulos você os encontram ao instalar o módulo level (via <code>npm install level</code>), sem a necessidade de instalar algo adicional em seu projeto Node.js.</p>
  <p>A comunidade Node também faz sua parte criando plugins, alguns em destaque são:</p>
  <ul>
    <li><a href="https://github.com/dominictarr/level-sublevel" target="_blank">Level-Sublevel</a> - cria registros JSON parecido com as collections do MongoDB;</li>
    <li><a href="https://github.com/dominictarr/level-inverted-index" target="_blank">Level-Inverted-Index</a> - realiza Full-Text Search nos registros;</li>
    <li><a href="https://github.com/eugeneware/jsonquery-engine" target="_blank">JSONQuery-Engine</a> - plugin para criar queries estilo MongoDB;</li>
    <li><a href="https://github.com/juliangruber/level-schedule" target="_blank">Level-Scheduler</a> - Schedule Jobs via LevelDB;</li>
    <li><a href="https://github.com/rvagg/node-level-multiply" target="_blank">Level-Multiply</a> - plugin para realizar queries com múltiplos dados;</li>
  </ul>

  {% include content-ads.ext %}

  <p>Neste link tem muito mais: <a href="https://github.com/rvagg/node-levelup/wiki/Modules" target="_blank">https://github.com/rvagg/node-levelup/wiki/Modules</a>.</p>
  <p>Para finalizar este post, mostrarei um pouco de código, criaremos um CRUD de cadastro de usuários, que será uma API em <a href="https://github.com/visionmedia/express" target="_blank">Express</a> com <a href="https://github.com/rvagg/node-levelup" target="_blank">LevelUP</a>.</p>
  <p>Crie o arquivo app.js incluindo o código abaixo:</p>

{% highlight javascript %}
var
  express = require('express'),
  uuid = require('node-uuid'),
  level = require('level'),
  db = level('./users.db'),
  app = express()
;

app.set('port', process.env.PORT || 3000);
app.use(express.logger());
app.use(express.json());
app.use(app.router);

app.get('/', function(req, res) {
  var users = [];
  var stream = db.createReadStream();
  stream.on('data', function (data) {
    users.push(data);
  });
  stream.on('error', function (err) {
    return res.json(500, err);
  })
  stream.on('end', function () {
    return res.json(200, users);
  });
});

app.get('/user/:id', function(req, res) {
  db.get(req.params.id, function(err, user) {
    if (err) return res.json(500, err);
    return res.json(200,user);
  });
});

app.post('/user', function(req, res) {
  db.put(uuid.v1(), req.body.user, function(err) {
    if (err) return res.json(500, err);
    return res.json(200);
  });
});

app.del('/user/:code', function(req, res) {
  db.del(req.params.code, function(err) {
    if (err) return res.json(500, err);
    return res.json(200);
  });
});

app.listen(app.get('port'), function() {
  console.log("API LevelDB na porta %d", app.get('port'));
});
{% endhighlight %}

  <p>Agora para criar a aplicação, execute:</p>

{% highlight bash %}
npm init
{% endhighlight %}

  <p>Responda as perguntas desse comando para no final gerar o <code>package.json</code> corretamente.</p>
  <p>Em seguida instale as dependências via comando:</p>

{% highlight bash %}
npm install express node-uuid level --save
{% endhighlight %}

  <p>Para ver sua API funcionando rode:</p>

{% highlight bash %}
node app
{% endhighlight %}

  <p>Se quiser testar sua API, utilize qualquer REST Client, como por exemplo o <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm" target="_blank">POSTMAN no Google Chrome</a>.</p>
  <p>Com esse rascunho de API, você já estará preparado para criar um front-end dessa aplicação. E caso queira aprofundar seus estudos em LevelDB junto com Node.js, acesse seu github: <a href="https://github.com/rvagg/node-levelup" target="_blank">https://github.com/rvagg/node-levelup</a></p>
</div>
